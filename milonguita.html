<head>
  <title>milonguita</title>
  <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.14.0/additional-methods.min.js"></script>
</head>

<body>
	<header id="header">
		<div class="container">
			<div class="row">
				<div class="col-md-4 text-left"><h1>Milonguita!</h1></div>
				<div class="col-md-8 text-right login">{{> loginFB}}</div>
			</div>
		</div>
	</header>
	<div class="container">
		<div class="row">
			<div class="col-md-12 text-center controls">
				<div class="col-md-6">
					{{#if currentUser}}		
						{{#if showPubForm }}
							<button class="show-pub-form btn btn-default">Close</button>	
						{{else}}
							<button class="show-pub-form btn btn-default">Add a new Publication <span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button>
						{{/if}}
					{{/if}}
				</div>
				<div class="col-md-6">
					{{#if existsPreviousWeek}}
					   <button class="previous-week btn btn-default"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span> Previous Week</button>
					{{/if}}
					{{#if existsNextWeek}}
					   <button class="next-week btn btn-default">Next Week <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></button>
					{{/if}}
				</div>
			</div>
		</div>
	</div>
	<div class="container">
		<div class="row">
			<div class="col-md-12 text-center">
				{{#if currentUser}}
			
					{{> addPublication}}

					{{#if showEditPubForm}}
						{{> editPublication}}
					{{/if}}
				
				{{/if}}
			</div>
		</div>
		
		{{#if showPubInfo}}
			<div class="row info">
				{{> infoPublication}}
			</div>
		{{/if}}
	
		<div class="row">
			<div class="col-md-12 text-left">
				{{> daysOfWeek}}
			</div>
		</div>
		
		{{#if isAdmin}}
		<div class="row">
			<div class="col-md-12 text-center">
				<button class="delete-old-pubs">Delete old publications</button>
			</div>
		</div>
		{{/if}}
	</div>
</body>

<template name="loginFB">
	{{#if currentUser}}
		<p>
			{{currentUser.services.facebook.name}}
			<button id="logout" class="btn btn-default">Salir</button>
		</p>
	{{else}}
		<p><button id="facebook-login" class="btn btn-default">Ingresar con Facebook</button></p>	
	{{/if}}
</template>

<template name="publication">
	<div class="col-md-4">
		<div class="col-md-12 box">
		<div class="col-md-12 text-center" style="margin-bottom:5px;">
			<h4>{{name}}</h4>
		</div>
		<div class="col-md-6 col-md-offset-3">
			<img src="{{c.url picPublicId height=150 width=150 crop='fill'}}" class="img-responsive img-circle"/>			
		</div>
		<div class="col-md-12 text-left">
			<p><span class="glyphicon glyphicon-bullhorn" aria-hidden="true"></span> <span class="text-capitalize">{{type}}</span></p>
			<p><span class="glyphicon glyphicon-time" aria-hidden="true"></span> Comienza: {{time}}</p>
			<p><span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span> Recomendada: {{upvoteCount}} {{#if pluralUpvoteCount}}veces{{else}}vez{{/if}}</p>
		</div>
		<div class="col-md-12 text-center" style="margin-top:5px;">
			<p>
				{{#if currentUser}}
					{{#if canUpvote}}
						<button class="btn btn-default upvote">Recomendar <span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span></button>
					{{else}}
						<button class="btn btn-default cancel-upvote">Recomendada <span class="glyphicon glyphicon-ok" aria-hidden="true"></span></button>
					{{/if}}
				{{/if}}
				<button class="pub-info btn btn-default">Ver mas</button>
			</p>
			{{#if isOwnerOrAdmin }}
				<button class="btn btn-default delete">Eliminar <span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
				<button class="btn btn-default show-edit-pub-form">Editar <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></button>
    		{{/if}}
		</div>
		</div>
	</div>
	
</template>

<template name="infoPublication">
	<div class="col-md-12 info-margin">	
		<div class="col-md-12">		
			<div class="col-md-4">
				<img src="{{c.url pubInfo.picPublicId}}" class="img-responsive" />
			</div>
			<div class="col-md-7 col-md-offset-1">
				<div class="col-md-12">
					<div class="col-md-10">
						<h2 style="margin-top:0;">{{pubInfo.name}}</h2>
					</div>
					<div class="col-md-2">
						<button class="close-info-pub btn btn-default pull-right">Cerrar</button>
					</div>
				</div>
				<div class="col-md-12" style="margin-top:10px;">
					<p>Tipo de publicacion: {{pubInfo.type}}</p>
					<p>Publicacion creada por {{pubInfo.username}}</p>
					<p>Direccion: {{pubInfo.address}}</p>
					<p>Fecha: {{pubInfo.date}}</p>
					<p>Costo: {{pubInfo.cost}}</p>
					<p>Hora: {{pubInfo.time}}</p>
					<p>Facebook: {{pubInfo.fbLink}}</p>
					<p>Recomendado por {{pubInfo.upvoteCount}} usuarios de milonguita</p>
				</div>
				<div class="col-md-12" style="margin-top:20px;">
					{{#unless isEmptyFBFriendsUpvoted}}
						<p>{{numFBFriendsUpvoted}} of your friends upvoted this publication.</p>
					{{/unless}}
					{{#each getFBFriendsUpvoted}}
							<img src="{{url}}" title="{{name}}"/>
					{{/each}}
				</div>
			</div>
			<div class="col-md-12 text-center" style="margin-top:10px;">
				<div class="col-md-4">
					<h4>Descripcion: </h4>
					<div class="col-md-12 text-left">
						<p>{{pubInfo.description}}</p>
					</div>
				</div>
				<div class="col-md-8">
					<h4>Mapa:</h4>
					<div class="col-md-12">
						<div class="col-md-10 col-md-offset-1">
							<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3151.7242004602595!2d-122.48044378471664!3d37.81992857975122!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x808586deffffffc3%3A0xcded139783705509!2sGolden+Gate+Bridge!5e0!3m2!1sen!2sus!4v1457746766331" width="400" height="400" frameborder="0" style="border:0" allowfullscreen></iframe>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</template>

<template name="addPublication">
	<div class="col-md-12 {{#unless showPubForm }}hide{{/unless}}">
		<h2>Agregar una nueva publicacion</h2>
		<form class="new-publication">
			<div class="col-md-12">				
				<input type="text" name="name" class="required" placeholder="name" />
			</div>
			<div class="col-md-12">				
				<select name="type" class="required">
				  <option value="milonga" {{isTypeMilonga editInfo.type}} >Milonga</option> 
				  <option value="event"  {{isTypeEvent editInfo.type}} >Evento</option>
				  <option value="practica" {{isTypePractica editInfo.type}} >Practica</option>
				</select>
			</div>										
			<div class="col-md-12">				
				<textarea name="description" class="required" rows="3" placeholder="descripcion" ></textarea>
			</div>	
			<div class="col-md-12">				
				<input type="text" name="address" class="required" placeholder="address" />
			</div>
			<div class="col-md-4 col-md-offset-4">				
					<input id="add-datepicker" name="date" class="required date" type="hidden" />
			</div>
			<div class="col-md-12">				
				<input type="text" name="cost" class="required" placeholder="cost" />
			</div>
			<div class="col-md-12">				
				<input type="text" name="time" class="required" placeholder="time" />
			</div>
			<div class="col-md-12">				
				<input type="text" name="fbLink" class="required url" placeholder="fb link" />
			</div>
			<div class="col-md-12">
				<input type="checkbox" name="keepPublication"/> Keep Publication.
			</div>
			<div class="col-md-12 text-center">
				<input type="file" id="photo_add" name="photo_add" accept="image/*"/>
			</div>
			<div class="col-md-12">				
				<input type="submit" value="Add Publication" />
			</div>
		</form>
	</div>

</template>

<template name="editPublication">
	<div class="col-md-8 col-md-offset-2 {{#unless showEditPubForm }}hide{{/unless}}">
		<form class="edit-publication">
				<div class="col-md-12">				
					<input type="hidden" name="id"  class="required" value="{{editInfo._id}}" />
				</div>							
				<div class="col-md-12">				
					<input type="text" name="name" class="required" value="{{editInfo.name}}" />
				</div>
				<div class="col-md-12">				
					<select name="type" class="required">
					  <option value="milonga" {{isTypeMilonga editInfo.type}} >Milonga</option> 
					  <option value="event"  {{isTypeEvent editInfo.type}} >Evento</option>
					  <option value="practica" {{isTypePractica editInfo.type}} >Practica</option>
					</select>
				</div>										
				<div class="col-md-12">				
					<textarea name="description" class="required" rows="3" value="{{editInfo.description}}" ></textarea>
				</div>	
				<div class="col-md-12">				
					<input type="text" name="address" class="required" value="{{editInfo.address}}" />
				</div>
				<div class="col-md-4 col-md-offset-4">				
					<input id="edit-datepicker" name="date" class="required date" type="hidden" />
				</div>
				<div class="col-md-12">				
					<input type="text" name="cost" class="required" value="{{editInfo.cost}}" />
				</div>
				<div class="col-md-12">				
					<input type="text" name="time" class="required" value="{{editInfo.time}}" />
				</div>
				<div class="col-md-12">				
					<input type="text" name="fbLink" class="required url" value="{{editInfo.fbLink}}" />
				</div>
				<div class="col-md-12 text-center">
					<input type="file" id="photo_edit" name="photo" accept="image/*"/>
				</div>
				<div class="col-md-12">				
					<input type="submit" value="Edit Publication" />
				</div>
			</form>
	</div>
</template>

<template name="daysOfWeek">
	<div class="col-md-12 day">
		<h4>{{nameOfDay 0}} ({{numberOfDate 0}})</h4>
	</div>
	<div class="col-md-12 day-grid">
	{{# each day 0}}
		{{> publication}}
	{{/each}}
	</div>

	<div class="col-md-12 day">
		<h4>{{nameOfDay 1}} ({{numberOfDate 1}})</h4>
	</div>
	<div class="col-md-12 day-grid">
	{{# each day 1}}
		{{> publication}}
	{{/each}}
	</div>

	<div class="col-md-12 day">
		<h4>{{nameOfDay 2}} ({{numberOfDate 2}})</h4>
	</div>
	<div class="col-md-12 day-grid">
	{{#each day 2}}
		{{> publication}}
	{{/each}}
	</div>

	<div class="col-md-12 day">
		<h4>{{nameOfDay 3}} ({{numberOfDate 3}})</h4>
	</div>
	<div class="col-md-12 day-grid">
	{{#each day 3}}
		{{> publication}}
	{{/each}}
	</div>

	<div class="col-md-12 day">
		<h4>{{nameOfDay 4}} ({{numberOfDate 4}})</h4>
	</div>
	<div class="col-md-12 day-grid">
	{{#each day 4}}
		{{> publication}}
	{{/each}}
	</div>

	<div class="col-md-12 day">
		<h4>{{nameOfDay 5}} ({{numberOfDate 5}})</h4>
	</div>
	<div class="col-md-12 day-grid">
	{{#each day 5}}
		{{> publication}}
	{{/each}}
	</div>

	<div class="col-md-12 day">
		<h4>{{nameOfDay 6}} ({{numberOfDate 6}})</h4>
	</div>
	<div class="col-md-12 day-grid">
	{{#each day 6}}
		{{> publication}}
	{{/each}}
	</div>
</template>
